<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Emoji Crush ğŸ‰ | English Training Hub</title>
<style>
  html, body {
    margin: 0; padding: 0;
    height: 100%;
    font-family: 'Poppins', sans-serif;
    text-align: center;
    overflow: hidden;
  }
  body {
    background: linear-gradient(135deg, #fefcea, #f1da36);
  }
  #loginScreen, #mapScreen, #gameScreen { display: none; }
  button {
    background: #4caf50; color: #fff; border: none;
    padding: 12px 24px; border-radius: 10px; cursor: pointer;
    font-size: 18px; margin: 8px;
  }
  input {
    padding: 10px; margin: 6px; border-radius: 8px; border: 1px solid #ccc;
  }
  .map-level {
    width: 80px; height: 80px;
    background: #fff; border-radius: 50%;
    display: inline-flex; align-items: center; justify-content: center;
    margin: 15px; cursor: pointer;
    font-weight: bold; box-shadow: 0 0 6px #999;
    transition: transform 0.2s;
  }
  .map-level:hover { transform: scale(1.1); background: #d4ffd4; }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen">
  <h1>Login to Play ğŸ®</h1>
  <input id="email" type="email" placeholder="Email" /><br />
  <input id="password" type="password" placeholder="Password" /><br />
  <button id="loginBtn">Login</button>
  <p id="loginMsg"></p>
</div>

<!-- MAP -->
<div id="mapScreen">
  <h2>Choose Level ğŸŒ</h2>
  <div id="mapLevels"></div>
  <button id="logoutBtn">Logout</button>
</div>

<!-- GAME -->
<div id="gameScreen">
  <header>
    <h3>English Training Hub</h3>
    <h1>Emoji Crush ğŸ‰</h1>
    <h2>ğŸ¾ Match 3+ Animal Emojis!</h2>
  </header>
  <div id="status">Score: 0 | Level: 1 | Target: 100</div>
  <div id="gameContainer"><div id="gameBoard"></div></div>
  <div id="message"></div>
  <button id="restart">Restart</button>
  <button id="backToMap">Back to Map</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyDwT8qfj5Lq2ev6QyHbEkKSmfhfRxyiPpY",
  authDomain: "emoji-crush-uth.firebaseapp.com",
  projectId: "emoji-crush-uth",
  storageBucket: "emoji-crush-uth.appspot.com",
  messagingSenderId: "527168444771",
  appId: "1:527168444771:web:7beabcb2be1e55ac3b5678"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

const loginScreen = document.getElementById("loginScreen");
const mapScreen = document.getElementById("mapScreen");
const gameScreen = document.getElementById("gameScreen");

const email = document.getElementById("email");
const password = document.getElementById("password");
const loginBtn = document.getElementById("loginBtn");
const loginMsg = document.getElementById("loginMsg");
const logoutBtn = document.getElementById("logoutBtn");

loginScreen.style.display = "block";

// LOGIN
loginBtn.addEventListener("click", () => {
  signInWithEmailAndPassword(auth, email.value, password.value)
    .then(() => {
      loginScreen.style.display = "none";
      mapScreen.style.display = "block";
      renderMap();
    })
    .catch(err => {
      loginMsg.textContent = "âŒ " + err.message;
    });
});

// LOGOUT
logoutBtn.addEventListener("click", () => {
  signOut(auth).then(() => {
    mapScreen.style.display = "none";
    loginScreen.style.display = "block";
  });
});

// MAP
function renderMap() {
  const map = document.getElementById("mapLevels");
  map.innerHTML = "";
  for (let i = 1; i <= 5; i++) {
    const level = document.createElement("div");
    level.className = "map-level";
    level.textContent = "Level " + i;
    level.addEventListener("click", () => startGame(i));
    map.appendChild(level);
  }
}

// GAME
let score = 0, level = 1;
const baseTarget = 100;
const rows = 16, cols = 12;
const animals = ['ğŸ¼','ğŸ¸','ğŸ·','ğŸ¦˜','ğŸ’'];
let board = [];
let selected = [];
const gameBoard = document.getElementById("gameBoard");
const statusDisplay = document.getElementById("status");
const messageDisplay = document.getElementById("message");

function startGame(selectedLevel) {
  mapScreen.style.display = "none";
  gameScreen.style.display = "block";
  level = selectedLevel;
  score = 0;
  initBoard();
}

document.getElementById("backToMap").addEventListener("click", () => {
  gameScreen.style.display = "none";
  mapScreen.style.display = "block";
});

// === Game Logic ===
function initBoard(){
  createRandomBoard();
  renderBoard();
  updateStatus();
}
function createRandomBoard(){
  board=[];
  for(let r=0;r<rows;r++){
    const row=[];
    for(let c=0;c<cols;c++){
      row.push(animals[Math.floor(Math.random()*animals.length)]);
    }
    board.push(row);
  }
}
function renderBoard(){
  gameBoard.innerHTML='';
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      const tile=document.createElement('div');
      tile.className='tile';
      tile.textContent=board[r][c];
      tile.dataset.row=r;
      tile.dataset.col=c;
      tile.addEventListener('click',tileClick);
      gameBoard.appendChild(tile);
    }
  }
}
function tileClick(e){
  const tile=e.currentTarget;
  const r=+tile.dataset.row, c=+tile.dataset.col;
  tile.classList.add('selected');
  selected.push({r,c,emoji:board[r][c],tile});
  if(selected.length>=3){
    const emoji=selected[0].emoji;
    if(selected.every(s=>s.emoji===emoji)){
      score+=selected.length*10;
      selected.forEach(s=>{
        board[s.r][s.c]=null;
        s.tile.style.visibility='hidden';
      });
      selected=[];
      updateStatus();
      fallDown();
    } else {
      selected.forEach(s=>s.tile.classList.remove('selected'));
      selected=[];
    }
  }
}
function fallDown(){
  for(let c=0;c<cols;c++){
    for(let r=rows-1;r>=0;r--){
      if(board[r][c]===null){
        for(let k=r-1;k>=0;k--){
          if(board[k][c]!=null){
            board[r][c]=board[k][c];
            board[k][c]=null;
            break;
          }
        }
      }
    }
    for(let r=0;r<rows;r++){
      if(board[r][c]===null){
        board[r][c]=animals[Math.floor(Math.random()*animals.length)];
      }
    }
  }
  renderBoard();
}
function updateStatus(){
  const target=baseTarget*level;
  statusDisplay.textContent=`Score: ${score} | Level: ${level} | Target: ${target}`;
}

document.getElementById('restart').addEventListener('click',()=>initBoard());
</script>
</body>
</html>
