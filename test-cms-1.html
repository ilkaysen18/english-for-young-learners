<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" >
<meta name="viewport" content="width=device-width,initial-scale=1" >
<title>English Lesson Hub - CMS</title>
<style>
:root {
--primary:#0078d7;
--primary-dark:#005fa3;
--bg:#f4f4f4;
--card:#fff;
--text:#222;
}

html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Helvetica,Arial,sans-serif;}

header{background:var(--primary);color:#fff;padding:1.2rem;text-align:center;}
header h1{margin:0;font-size:1.6rem}
header p{margin:.2rem 0 0 0;opacity:.9}

.wrap{max-width:780px;margin:1rem auto;padding:0 1rem}
.container{background:var(--card);border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,.08);padding:1rem;margin-bottom:1rem}

h2{margin:.2rem 0 1rem 0}

input,textarea,select{width:100%;padding:.6rem .7rem;margin:.35rem 0;border:1px solid #d0d5dd;border-radius:8px;font-size:16px;box-sizing:border-box;}

button{background:var(--primary);color:#fff;border:none;padding:.6rem 1rem;border-radius:8px;cursor:pointer;font-weight:600}
button:hover{background:var(--primary-dark)}

.btn-secondary{background:#555}
.btn-secondary:hover{background:#444}

.row{display:flex;gap:.5rem;flex-wrap:wrap}
.row > *{flex:1}

.lesson{padding:1rem;border:1px solid #eee;border-radius:10px;margin:.7rem 0;text-align:left}
.lesson h3{margin:.2rem 0;color:var(--primary)}

nav a{text-decoration:none;background:var(--primary);color:#fff;padding:.35rem .7rem;border-radius:7px;margin:.2rem;display:inline-block}
nav a:hover{background:var(--primary-dark)}

#authMsg{min-height:1.2em;color:#d11}
.muted{color:#666;font-size:.9rem}

/* Course-specific styles for form */
.course-kids-eng {
  font-family: 'Comic Neue', cursive;
  background: linear-gradient(to bottom, #a7dfff, #f6faff);
  border-radius: 20px;
  padding: 20px;
}
.course-kids-eng input,
.course-kids-eng textarea,
.course-kids-eng select {
  font-family: 'Comic Neue', cursive;
  font-size: 18px;
  border-radius: 15px;
  background: #fdf6e3;
}
.course-kids-eng button {
  background: #ffd34e;
  color: #333;
  font-family: 'Comic Neue', cursive;
  font-size: 18px;
  border-radius: 10px;
  box-shadow: 0 3px 0 #e0a800;
}
.course-kids-eng button:hover {
  background: #ffe678;
}

.course-gen-eng {
  font-family: Georgia, serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-radius: 15px;
  padding: 20px;
}
.course-gen-eng input,
.course-gen-eng textarea,
.course-gen-eng select {
  font-family: Georgia, serif;
  font-size: 17px;
  background: rgba(255,255,255,0.9);
  border-radius: 10px;
}
.course-gen-eng button {
  background: #764ba2;
  font-family: Georgia, serif;
  border-radius: 10px;
}
.course-gen-eng button:hover {
  background: #5a3777;
}

.course-spkpiceng {
  font-family: 'Trebuchet MS', sans-serif;
  background: linear-gradient(to right, #ff7e5f, #feb47b);
  border-radius: 18px;
  padding: 20px;
  color: #2c3e50;
}
.course-spkpiceng input,
.course-spkpiceng textarea,
.course-spkpiceng select {
  font-family: 'Trebuchet MS', sans-serif;
  font-size: 17px;
  background: #fff8f0;
  border: 2px solid #ff7e5f;
  border-radius: 12px;
}
.course-spkpiceng button {
  background: #ff6348;
  color: white;
  font-family: 'Trebuchet MS', sans-serif;
  border-radius: 12px;
  box-shadow: 0 4px 0 #d14836;
}
.course-spkpiceng button:hover {
  background: #ff7f6e;
}
</style>
<link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap" rel="stylesheet">
</head>

<body>
<header>
<h1>üåç English Lesson Hub - CMS</h1>
<p>Content Management System</p>
</header>

<div class="wrap">
<!-- DASHBOARD -->
<div class="container" id="dashboard">
<h2>Content Management</h2>
<button id="toggleFormBtn">‚ûï New Lesson</button>

<form id="lessonForm" style="display:none;margin-top:.6rem" class="">
<label style="font-weight:600;display:block;margin-top:10px;">Select Course:</label>
<select id="courseSelect" required>
<option value="">-- Choose a Course --</option>
<option value="kids-eng">KIDS ENGLISH üçè</option>
<option value="gen-eng">GENERAL ENGLISH ü¶ò</option>
<option value="spkpiceng">SPEAKING WITH PICTURES üñº</option>
</select>

<div class="row">
<input id="lessonOrder" type="number" placeholder="Lesson Number" required >
</div>
<input id="lessonTitle" placeholder="Lesson Title (e.g., Lesson 1 ‚Äì Animals üê∂)" required >
<textarea id="lessonBody" rows="5" placeholder="Lesson content" required></textarea>
<button type="submit">Save Lesson</button>
</form>

<div id="lessonsList" style="margin-top:1rem"><h3>üìò All Lessons</h3></div>
</div>

<!-- PUBLIC VIEW -->
<div class="container" id="public">
<h2>üåè Course Viewer</h2>
<div id="viewerList"></div>
</div>
</div>

<script type="module">
// Firebase modular v9+ imports
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-analytics.js";
import {
getAuth,
onAuthStateChanged,
signInWithEmailAndPassword,
signOut,
} from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
import {
getFirestore,
collection,
addDoc,
getDocs,
orderBy,
query,
where,
} from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

// Config
const firebaseConfig = {
apiKey: "AIzaSyBx4To2-DIglfgq_eHve3bYXYKdsZ0sgEo",
authDomain: "english-training-hub.firebaseapp.com",
projectId: "english-training-hub",
storageBucket: "english-training-hub.firebasestorage.app",
messagingSenderId: "927072446139",
appId: "1:927072446139:web:721de952b0e0b7aa19ab9e",
measurementId: "G-34BBV99KXB",
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
try { getAnalytics(app); } catch (_) {}
const auth = getAuth(app);
const db = getFirestore(app);

// UI elements
const dash = document.getElementById("dashboard");
const lessonForm = document.getElementById("lessonForm");
const list = document.getElementById("lessonsList");
const viewer = document.getElementById("viewerList");
const toggleFormBtn = document.getElementById("toggleFormBtn");
const courseSelect = document.getElementById("courseSelect");

toggleFormBtn.addEventListener("click", () => {
lessonForm.style.display = lessonForm.style.display === "block" ? "none" : "block";
});

// Change form styling based on course selection
courseSelect.addEventListener("change", (e) => {
const course = e.target.value;
// Remove all course classes
lessonForm.classList.remove('course-kids-eng', 'course-gen-eng', 'course-spkpiceng');
// Add the selected course class
if (course) {
lessonForm.classList.add(`course-${course}`);
}
});

// Custom alert function
function showAlert(message) {
const modal = document.createElement('div');
modal.className = 'fixed';
modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999;';
modal.innerHTML = `
<div style="background:white;padding:20px;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,0.3);max-width:400px;margin:20px;">
<p style="margin:0 0 15px 0;color:#222;">${message}</p>
<button onclick="this.closest('.fixed').remove()" style="background:#0078d7;color:white;border:none;padding:8px 16px;border-radius:8px;cursor:pointer;font-weight:600;">OK</button>
</div>
`;
document.body.appendChild(modal);
}

// Save lesson
lessonForm.addEventListener("submit", async (e) => {
e.preventDefault();
const course = courseSelect.value;
const order = parseInt(document.getElementById("lessonOrder").value, 10);
const title = document.getElementById("lessonTitle").value.trim();
const content = document.getElementById("lessonBody").value.trim();

if (!course || !Number.isFinite(order) || !title || !content) {
showAlert("Please fill all fields");
return;
}

await addDoc(collection(db, "lessons"), {
course,
order,
title,
content,
timestamp: Date.now()
});

lessonForm.reset();
lessonForm.style.display = "none";
lessonForm.classList.remove('course-kids-eng', 'course-gen-eng', 'course-spkpiceng');
await loadLessons();
await loadPublic();
});

// Load lessons for CMS
async function loadLessons() {
if (!list) return;
list.innerHTML = "<h3>üìò All Lessons</h3>";
const q = query(collection(db, "lessons"), orderBy("order", "asc"));
const snap = await getDocs(q);
snap.forEach((doc) => {
const d = doc.data();
const div = document.createElement("div");
div.className = "lesson";
const courseNames = {
'kids-eng': 'KIDS ENGLISH üçè',
'gen-eng': 'GENERAL ENGLISH ü¶ò',
'spkpiceng': 'SPEAKING WITH PICTURES üñº'
};
const courseName = courseNames[d.course] || d.course;
div.innerHTML = `<strong>#${d.order}</strong> ${d.title} <br><small style="color:#666;">${courseName}</small>`;
list.appendChild(div);
});
}

// Load public viewer
async function loadPublic() {
if (!viewer) return;
viewer.innerHTML = "";
const q = query(collection(db, "lessons"), orderBy("course", "asc"), orderBy("order", "asc"));
const snap = await getDocs(q);
const lessonsByCourse = {};
snap.docs.forEach(doc => {
const data = doc.data();
if (!lessonsByCourse[data.course]) {
lessonsByCourse[data.course] = [];
}
lessonsByCourse[data.course].push(data);
});

const courseNames = {
'kids-eng': 'KIDS ENGLISH üçè',
'gen-eng': 'GENERAL ENGLISH ü¶ò',
'spkpiceng': 'SPEAKING WITH PICTURES üñº'
};

Object.keys(lessonsByCourse).forEach(course => {
const courseDiv = document.createElement("div");
courseDiv.style.marginBottom = "30px";
const courseTitle = document.createElement("h3");
courseTitle.textContent = courseNames[course] || course;
courseTitle.style.color = "var(--primary)";
courseDiv.appendChild(courseTitle);

lessonsByCourse[course].forEach((l, i) => {
const div = document.createElement("div");
div.className = "lesson";
div.id = `lesson${course}${l.order}`;
const lines = (l.content || "").split("\n").filter(Boolean);
const contentHtml = lines.map(line => {
const [emoji, ...words] = line.split(" ");
return `<p>${emoji || ""} ${words.join(" ")}</p>`;
}).join("");

div.innerHTML = `
<h4>${l.title}</h4>
${contentHtml}
<nav>
${i>0 ? `<a href="#lesson${course}${lessonsByCourse[course][i-1].order}">‚Üê Previous</a>` : ""}
<a href="#top">Back to Top</a>
${i<lessonsByCourse[course].length-1 ? `<a href="#lesson${course}${lessonsByCourse[course][i+1].order}">Next ‚Üí</a>` : ""}
</nav>
`;
courseDiv.appendChild(div);
});

viewer.appendChild(courseDiv);
});
}

// Load on page load
loadLessons();
loadPublic();
</script>
</body>
</html>
