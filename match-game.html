<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Letter Candy Match üç≠</title>
<style>
  :root {
    --cell-size: 55px;
  }
  body {
    margin: 0;
    background: linear-gradient(45deg, #ffb6c1, #ff69b4, #ff1493);
    font-family: 'Poppins', sans-serif;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }

  h1 {
    margin: 20px;
    text-shadow: 2px 2px 6px rgba(0,0,0,0.4);
  }

  #word-display, #scoreboard {
    font-size: 1.3em;
    margin-bottom: 10px;
  }

  #board {
    display: grid;
    grid-template-columns: repeat(8, var(--cell-size));
    grid-template-rows: repeat(8, var(--cell-size));
    border: 5px solid #fff;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(255,255,255,0.4);
  }

  .cell {
    width: var(--cell-size);
    height: var(--cell-size);
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
    color: #fff;
    font-size: 1.2em;
    user-select: none;
    transition: transform 0.2s ease, border 0.2s;
  }

  .cell.selected {
    transform: scale(1.2);
    border: 3px solid #fff;
  }

  /* Candy Colors */
  .red { background-color: #ff4d4d; }
  .orange { background-color: #ffa64d; }
  .yellow { background-color: #ffde59; color: #000; }
  .green { background-color: #66cc66; }
  .blue { background-color: #4da6ff; }
  .purple { background-color: #c266ff; }

  button {
    margin-top: 15px;
    background: #fff;
    color: #ff1493;
    border: none;
    border-radius: 8px;
    padding: 10px 20px;
    font-weight: bold;
    cursor: pointer;
  }

  button:hover {
    background-color: #ffd6eb;
  }

  #message {
    margin-top: 10px;
    font-size: 1.1em;
  }
  @media (max-width: 500px) {
    :root {
      --cell-size: 42px;
    }
  }
</style>
</head>
<body>
  <h1>Letter Candy Match üç≠</h1>
  <div id="word-display">Word: <span id="word-progress">_ _ _ _ _</span></div>
  <div id="scoreboard">Score: <span id="score">0</span></div>
  <div id="board"></div>
  <button id="restart">Restart</button>
  <div id="message"></div>

<script>
  const board = document.getElementById('board');
  const scoreDisplay = document.getElementById('score');
  const wordProgressDisplay = document.getElementById('word-progress');
  const message = document.getElementById('message');
  const restart = document.getElementById('restart');

  const width = 8;
  const colors = ['red','orange','yellow','green','blue','purple'];
  const letters = ['C','A','N','D','Y']; // target word
  const targetWord = "CANDY";
  let collected = { C:0, A:0, N:0, D:0, Y:0 };
  let squares = [];
  let selected = null;
  let score = 0;

  /* --- Setup --- */
  function updateWordProgress() {
    const display = letters.map(l => (collected[l]>0 ? l : '_')).join(' ');
    wordProgressDisplay.textContent = display;
    if (letters.every(l => collected[l]>0)){
      message.innerHTML = `üéâ You spelled <strong>${targetWord}</strong>! üç¨`;
    }
  }

  function createBoard(){
    squares = [];
    board.innerHTML = '';
    score = 0;
    scoreDisplay.textContent = 0;
    message.textContent = '';
    collected = { C:0, A:0, N:0, D:0, Y:0 };
    updateWordProgress();

    for(let i=0;i<width*width;i++){
      const div = document.createElement('div');
      const color = colors[Math.floor(Math.random()*colors.length)];
      div.className = `cell ${color}`;
      div.dataset.id = i;
      if (Math.random()<0.1){
        const letter = letters[Math.floor(Math.random()*letters.length)];
        div.textContent = letter;
        div.dataset.letter = letter;
      } else {
        div.textContent = '';
        div.dataset.letter = '';
      }
      div.addEventListener('click', () => handleSelect(i));
      board.appendChild(div);
      squares.push(div);
    }
  }

  function handleSelect(i){
    if(!selected){
      selected = i;
      squares[i].classList.add('selected');
      return;
    }
    if(selected === i){
      squares[i].classList.remove('selected');
      selected = null;
      return;
    }

    const valid = [selected-1, selected+1, selected-width, selected+width];
    const target = i;
    if(valid.includes(target)){
      swapCandies(selected, target);
      if(!checkMatches()){
        // no match -> revert
        swapCandies(selected, target);
      }
    }
    squares[selected].classList.remove('selected');
    selected = null;
  }

  function swapCandies(a,b){
    const tempColor = squares[a].classList[1];
    const tempLetter = squares[a].dataset.letter;
    const tempText = squares[a].textContent;

    squares[a].classList.replace(tempColor, squares[b].classList[1]);
    squares[a].dataset.letter = squares[b].dataset.letter;
    squares[a].textContent = squares[b].textContent;

    squares[b].classList.replace(squares[b].classList[1], tempColor);
    squares[b].dataset.letter = tempLetter;
    squares[b].textContent = tempText;
  }

  function destroyCell(i){
    const letter = squares[i].dataset.letter;
    if(letter && collected.hasOwnProperty(letter) && collected[letter]===0)
      collected[letter]=1;
    squares[i].className = 'cell';
    squares[i].textContent='';
    squares[i].dataset.letter='';
  }

  function checkMatches(){
    let matched = false;
    // Row matches
    for(let i=0;i<width*width;i++){
      if(i%width > width-4) continue;
      const row=[i,i+1,i+2];
      const color = squares[i].classList[1];
      if(color && row.every(idx=>squares[idx].classList[1]===color)){
        row.forEach(idx => destroyCell(idx));
        score+=30; matched=true;
      }
    }
    // Col matches
    for(let i=0;i<width*(width-2);i++){
      const col=[i,i+width,i+2*width];
      const color = squares[i].classList[1];
      if(color && col.every(idx=>squares[idx].classList[1]===color)){
        col.forEach(idx => destroyCell(idx));
        score+=30; matched=true;
      }
    }
    scoreDisplay.textContent=score;
    if(matched) updateWordProgress();
    return matched;
  }

  function moveDown(){
    for(let i=width*(width-1)-1;i>=0;i--){
      if(squares[i+width] && squares[i+width].classList.length===1){
        copyCell(i,i+width);
        clearCell(i);
      }
    }
    // Fill top row
    for(let i=0;i<width;i++){
      if(squares[i].classList.length===1){
        const color=colors[Math.floor(Math.random()*colors.length)];
        squares[i].classList.add(color);
        if(Math.random()<0.1){
          const letter=letters[Math.floor(Math.random()*letters.length)];
          squares[i].textContent=letter;
          squares[i].dataset.letter=letter;
        }
      }
    }
  }

  function copyCell(from,to){
    const color=squares[from].classList[1];
    if(color){ squares[to].classList.add(color); }
    squares[to].textContent=squares[from].textContent;
    squares[to].dataset.letter=squares[from].dataset.letter;
  }
  function clearCell(i){
    squares[i].className='cell';
    squares[i].textContent='';
    squares[i].dataset.letter='';
  }

  function gameLoop(){
    moveDown();
    checkMatches();
  }

  restart.addEventListener('click', createBoard);

  createBoard();
  setInterval(gameLoop,200);
</script>
</body>
</html>
