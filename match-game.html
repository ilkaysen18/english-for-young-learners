<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Animal Emoji Match‚Äë3 Game</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    background: linear-gradient(135deg, #fefcea, #f1da36);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    margin: 0;
    min-height: 100vh;
    text-align: center;
  }
  h1 { color: #444; margin-bottom: 5px; }
  #status {
    font-size: 17px;
    font-weight: bold;
    margin: 6px 0;
  }
  #gameBoard {
    display: grid;
    grid-template-columns: repeat(6, 60px);
    grid-gap: 6px;
    margin-top: 15px;
    position: relative;
  }
  .tile {
    width: 60px;
    height: 60px;
    background: #fff;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 30px;
    cursor: pointer;
    transition: transform 0.2s, background 0.25s;
  }
  .tile.selected { background: #b8ffba; transform: scale(1.1); }
  #message { font-size: 18px; font-weight: bold; margin-top: 12px; color: #3b7a00; min-height: 30px; }
  button {
    margin-top: 15px;
    background: #4caf50;
    color: white;
    border: none;
    padding: 10px 18px;
    font-size: 16px;
    border-radius: 5px;
    cursor: pointer;
  }
  button:hover { background: #45a049; }

  @keyframes fall {
    from { transform: translateY(-80px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  @media (max-width: 480px) {
    #gameBoard { grid-template-columns: repeat(5, 50px); }
    .tile { width: 50px; height: 50px; font-size: 26px; }
  }
</style>
</head>
<body>
<h1>üêæ Match 3 Animal Emojis!</h1>
<div id="status">Score: 0 | Level: 1 | Target: 100</div>
<div id="gameBoard"></div>
<div id="message"></div>
<button id="submitMatch">Submit Match</button>
<button id="restart">Restart</button>

<script>
  const boardSize = 6;
  const animals = ['üê∂','üê±','üê∞','üêª','ü¶ä','üêº','üê∏','ü¶Å','üê∑'];
  let board = [];
  let selected = [];
  let score = 0;
  let level = 1;
  const baseTarget = 100;

  const gameBoard = document.getElementById('gameBoard');
  const statusDisplay = document.getElementById('status');
  const messageDisplay = document.getElementById('message');

  // === SOUND SYSTEM ===
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  function playTone(freq, dur=0.15, type='sine', vol=0.2){
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = type;
    osc.frequency.value = freq;
    gain.gain.value = vol;
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + dur);
  }
  function successSound(){
    [440, 660, 880].forEach((f,i)=>setTimeout(()=>playTone(f,0.15), i*150));
  }
  function failSound(){
    [200,150].forEach((f,i)=>setTimeout(()=>playTone(f,0.2,'square'), i*250));
  }
  function victorySound(){
    [523,659,784,1046].forEach((f,i)=>setTimeout(()=>playTone(f,0.2,'triangle',0.25), i*200));
  }

  // === GAME INITIALIZATION ===
  function initBoard(){
    board = [];
    for(let r=0;r<boardSize;r++){
      const row = [];
      for(let c=0;c<boardSize;c++){
        const emoji = animals[Math.floor(Math.random()*animals.length)];
        row.push(emoji);
      }
      board.push(row);
    }
    renderBoard();
    updateStatus();
    messageDisplay.textContent = '';
  }

  function renderBoard(){
    gameBoard.innerHTML = '';
    for(let r=0;r<boardSize;r++){
      for(let c=0;c<boardSize;c++){
        const tile = document.createElement('div');
        tile.className = 'tile';
        tile.textContent = board[r][c];
        tile.dataset.row = r;
        tile.dataset.col = c;
        tile.addEventListener('click', tileClick);
        gameBoard.appendChild(tile);
      }
    }
  }

  function tileClick(e){
    const tile = e.currentTarget;
    const r = parseInt(tile.dataset.row);
    const c = parseInt(tile.dataset.col);
    if(tile.classList.contains('selected')) return;

    tile.classList.add('selected');
    selected.push({r,c,emoji: board[r][c],tile});
  }

  document.getElementById('submitMatch').addEventListener('click', () => {
    if (selected.length === 3) {
      const [a, b, c] = selected;
      if (a.emoji === b.emoji && b.emoji === c.emoji) {
        // Check adjacency
        if (areAdjacent(a, b) && areAdjacent(b, c)) {
          successSound();
          score += 10;
          a.tile.style.visibility = b.tile.style.visibility = c.tile.style.visibility = 'hidden';
          board[a.r][a.c] = board[b.r][b.c] = board[c.r][c.c] = null;
          updateStatus();
          setTimeout(() => { fallDown(); }, 400);
        } else {
          failSound();
          selected.forEach(s => s.tile.classList.remove('selected'));
        }
      } else {
        failSound();
        selected.forEach(s => s.tile.classList.remove('selected'));
      }
      selected = [];
    } else {
      alert("Please select three animals!");
    }
  });

  function areAdjacent(a, b) {
    return (Math.abs(a.r - b.r) + Math.abs(a.c - b.c) === 1);
  }

  // === CASCADE FALLING ===
  function fallDown(){
    for(let c=0;c<boardSize;c++){
      let emptyRow = boardSize-1;
      for(let r=boardSize-1;r>=0;r--){
        if(board[r][c]!==null){
          board[emptyRow][c] = board[r][c];
          if(emptyRow !== r) board[r][c] = null;
          emptyRow--;
        }
      }
      // Fill new emojis
      for(let r=emptyRow;r>=0;r--){
        board[r][c] = animals[Math.floor(Math.random()*animals.length)];
      }
    }
    renderFall();
    checkLevelComplete();
  }

  function renderFall(){
    gameBoard.innerHTML = '';
    for(let r=0;r<boardSize;r++){
      for(let c=0;c<boardSize;c++){
        const tile = document.createElement('div');
        tile.className = 'tile';
        tile.textContent = board[r][c];
        tile.dataset.row = r;
        tile.dataset.col = c;
        tile.style.animation = 'fall 0.4s ease';
        tile.addEventListener('click', tileClick);
        gameBoard.appendChild(tile);
      }
    }
  }

  function checkLevelComplete(){
    const target = baseTarget * level;
    if(score >= target){
      victorySound();
      messageDisplay.textContent = `üéâ You cleared Level ${level}! ü•≥`;
      const nextBtn = document.createElement('button');
      nextBtn.textContent = `Next Level ‚ñ∂Ô∏è`;
      nextBtn.onclick = ()=>{
        level++;
        messageDisplay.textContent = '';
        initBoard();
      };
      messageDisplay.appendChild(nextBtn);
    }
  }

  function updateStatus(){
    const target = baseTarget * level;
    statusDisplay.textContent = `Score: ${score} | Level: ${level} | Target: ${target}`;
  }

  document.getElementById('restart').addEventListener('click', ()=>{
    score = 0; level = 1;
    initBoard();
  });

  initBoard();
</script>
</body>
</html>
