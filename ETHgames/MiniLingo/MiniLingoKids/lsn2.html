<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Lesson 2 ‚Äî Is it sunny?</title>
<meta name="theme-color" content="#4CAF50"/>
<style>
:root{--accent:#4CAF50;--good:#4CAF50;--bad:#FF6B6B;--card:#fff;--shadow:0 10px 28px rgba(10,20,30,.08);--r:14px}
*{box-sizing:border-box}body{font-family:Inter,system-ui,Arial;margin:0;background:linear-gradient(180deg,#E1F5FE,#D0F0FF);color:#072A3A;display:flex;align-items:flex-start;justify-content:center;padding:20px}
.wrapper{width:100%;max-width:720px;background:var(--card);border-radius:18px;box-shadow:var(--shadow);overflow:hidden}
.header{background:linear-gradient(90deg,var(--accent),#81C784);color:#fff;padding:14px 18px;display:flex;justify-content:space-between;align-items:center}
.title{font-weight:800}
.container{display:flex;gap:18px;padding:18px}
.main{flex:1}
.sidebar{width:300px}
.card{background:#fff;border-radius:12px;padding:12px;border:1px solid rgba(6,8,10,0.04);margin-bottom:12px}
.characters{display:flex;gap:10px;flex-wrap:wrap}
.char{flex:1 0 48%;display:flex;align-items:center;gap:10px;padding:10px;border-radius:10px;background:linear-gradient(180deg,#fff,#e6f7ff);cursor:pointer}
.char .emoji{font-size:2rem}
.sentence{margin-top:10px;padding:10px;border-radius:10px;background:linear-gradient(90deg,rgba(76,175,80,.06),rgba(129,199,132,.03));font-weight:800;display:flex;gap:10px;align-items:center}
.hidden{display:none}
.choices{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px}
.btn{padding:10px;border-radius:10px;border:none;cursor:pointer;font-weight:800}
.btn-primary{background:var(--accent);color:#fff}
.choice{background:#fff;padding:12px;border-radius:10px;border:1px solid rgba(6,8,10,.06);display:flex;align-items:center;gap:8px;cursor:pointer}
.feedback{height:36px;margin-top:10px;font-weight:800}
.progress{height:8px;background:#e6f7ff;border-radius:999px;overflow:hidden;margin-top:10px}
.progress > div{height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--good));transition:width .4s}
.small{font-size:.9rem;color:#6b7280}
.toggle{display:flex;gap:8px;align-items:center;margin-top:10px}
.switch{display:inline-flex;align-items:center;gap:6px}
.switch input{transform:scale(1.1)}
</style>
</head>
<body>
<div class="wrapper" role="main" aria-labelledby="lessonTitle">
  <div class="header">
    <div class="title" id="lessonTitle">Lesson 2 ‚Äî Is it sunny? ‚òÄÔ∏èüåßÔ∏è</div>
    <div class="small" id="status">XP: <span id="xp">0</span> ‚Ä¢ Streak: <span id="streak">0</span></div>
  </div>

  <div class="container">
    <div class="main">
      <!-- Learn -->
      <div class="sentence" id="example">‚òÄÔ∏è <span style="opacity:.85">Is it sunny?</span></div>
      <div class="card" id="learn">
        <div style="font-weight:800">Ask and answer: <span class="small">Yes / No</span></div>
        <div class="characters" id="chars" aria-hidden></div>

        <div style="margin-top:10px;display:flex;gap:8px">
          <button class="btn btn-primary" onclick="startPractice()">Start Practice ‚ûú</button>
          <button class="btn" onclick="speak('Is it sunny? No, it is rainy. Yes, it is sunny. No, it is cloudy.')">üîä Hear</button>
        </div>

        <div class="toggle">
          <label class="small">Show full answers</label>
          <div class="switch"><input type="checkbox" id="showAnswers" checked onchange="renderChars()"/></div>
        </div>
      </div>

      <!-- Practice -->
      <div class="card hidden" id="practice">
        <div style="display:flex;align-items:center;gap:12px">
          <div style="font-weight:800" id="practiceSentence">Is it sunny?</div>
          <div style="margin-left:auto" class="small" id="score">0 / 4</div>
        </div>
        <div class="progress" aria-hidden><div id="bar" style="width:0%"></div></div>
        <div class="choices" id="options" role="list"></div>
        <div class="feedback" id="feedback" aria-live="polite"></div>
        <div style="display:flex;justify-content:space-between;margin-top:12px">
          <button class="btn" onclick="skip()">Skip</button>
          <button class="btn btn-primary" id="nextBtn" onclick="nextQ()" disabled>Next ‚Üí</button>
        </div>
      </div>

      <!-- Review -->
      <div class="card hidden" id="review">
        <h3 style="margin:0">Review</h3>
        <div id="reviewArea"></div>
        <div style="margin-top:10px" id="reviewResult"></div>
      </div>
    </div>
  </div>
</div>

<script>
const QUESTIONS = [
  {id:1,emoji:'‚òÄÔ∏è',q:'Is it sunny?', yes:'Yes, it is sunny.', no:'No, it is not sunny.'},
  {id:2,emoji:'üåßÔ∏è',q:'Is it rainy?', yes:'Yes, it is rainy.', no:'No, it is not rainy.'},
  {id:3,emoji:'üå®Ô∏è',q:'Is it snowy?', yes:'Yes, it is snowy.', no:'No, it is not snowy.'},
  {id:4,emoji:'üå¨Ô∏è',q:'Is it windy?', yes:'Yes, it is windy.', no:'No, it is not windy.'}
];

let state = { index:0, corrects:0, xp:(JSON.parse(localStorage.getItem('minilingoState')||'{}').xp||0), streak:(JSON.parse(localStorage.getItem('minilingoState')||'{}').streak||0), order:[] };

function save(){ const s=JSON.parse(localStorage.getItem('minilingoState')||'{}'); s.xp=state.xp; s.streak=state.streak; localStorage.setItem('minilingoState',JSON.stringify(s)); }
function speak(txt){ if(window.speechSynthesis){ const u=new SpeechSynthesisUtterance(txt); u.lang='en-US'; window.speechSynthesis.cancel(); window.speechSynthesis.speak(u); } }

function renderChars(){
  const el=document.getElementById('chars'); el.innerHTML='';
  const showFull = document.getElementById('showAnswers')?.checked ?? true;
  QUESTIONS.forEach(w=>{
    const b=document.createElement('button'); b.className='char';
    b.onclick=()=>{ document.getElementById('example').textContent = `${w.emoji} ${showFull ? w.yes : w.q}`; speak(showFull ? w.yes : w.q); };
    const inner = showFull ? `<div class="emoji">${w.emoji}</div><div style="font-weight:700">${w.q}<div style="font-weight:600;font-size:.9rem;color:#666;margin-top:4px">${w.yes} / ${w.no}</div></div>` : `<div class="emoji">${w.emoji}</div><div style="font-weight:700">${w.q}</div>`;
    b.innerHTML = inner;
    el.appendChild(b);
  });
}
renderChars();

function startPractice(){
  document.getElementById('learn').classList.add('hidden');
  document.getElementById('practice').classList.remove('hidden');
  state.index=0; state.corrects=0; state.order=shuffle(QUESTIONS.slice());
  loadQ();
}

function loadQ(){
  const cur = state.order[state.index];
  document.getElementById('practiceSentence').textContent = cur.q;
  speak(cur.q);
  document.getElementById('score').textContent = `${state.corrects} / ${QUESTIONS.length}`;
  document.getElementById('bar').style.width = `${(state.index/QUESTIONS.length)*100}%`;
  document.getElementById('feedback').textContent = '';
  document.getElementById('nextBtn').disabled = true;

  // Present two options: Yes and No (but with example short answers)
  const container=document.getElementById('options'); container.innerHTML='';
  const yesCard = document.createElement('div'); yesCard.className='choice';
  yesCard.innerHTML = `<div style="font-size:1.8rem">‚úÖ</div><div style="font-weight:700">Yes ‚Äî ${cur.yes}</div>`;
  yesCard.onclick = ()=>choose(true,cur.id,yesCard);

  const noCard = document.createElement('div'); noCard.className='choice';
  noCard.innerHTML = `<div style="font-size:1.8rem">‚ùå</div><div style="font-weight:700">No ‚Äî ${cur.no}</div>`;
  noCard.onclick = ()=>choose(false,cur.id,noCard);

  // Randomize order
  if(Math.random()>.5){ container.appendChild(yesCard); container.appendChild(noCard); } else { container.appendChild(noCard); container.appendChild(yesCard); }
}

function choose(answerYes,correctId,node){
  // Determine correct answer by checking QUESTIONS array:
  const cur = state.order[state.index];
  // For these lessons, the correct "Yes" is when the sentence matches the emoji question; we treat the displayed question as correct when the emoji indicates the true weather.
  // We'll consider "Yes" correct if the question's emoji corresponds to an affirmative weather state.
  // In our dataset each question's 'yes' is the true affirmative ‚Äî both choices mapped to the same cur item, so accept "Yes" as the correct pick for the intended correct response.
  // For variation, we'll mark the 'correct' answer as Yes for the first two, No for the latter two ‚Äî this creates both Yes and No correct cases.
  const yesIsCorrect = (cur.id===1 || cur.id===2); // sunny & rainy -> Yes correct, snowy & windy -> No correct (example variation)
  const userPickedYes = !!answerYes;

  if(userPickedYes === yesIsCorrect){
    state.corrects++; state.xp+=5; state.streak++; save();
    document.getElementById('feedback').innerHTML = `<span style="color:var(--good)">‚úÖ Correct!</span>`;
    node.style.boxShadow = '0 10px 24px rgba(72,187,120,.14)';
    document.getElementById('nextBtn').disabled=false;
    document.getElementById('bar').style.width = `${((state.index+1)/QUESTIONS.length)*100}%`;
  } else {
    state.xp+=1; state.streak=0; save();
    document.getElementById('feedback').innerHTML = `<span style="color:var(--bad)">‚ùå Try again!</span>`;
    node.animate([{transform:'translateX(-6px)'},{transform:'translateX(6px)'},{transform:'translateX(0)'}],{duration:240});
  }
  updateStatus();
}

function updateStatus(){ document.getElementById('xp').textContent=state.xp; document.getElementById('streak').textContent=state.streak; }
function nextQ(){ state.index++; if(state.index>=QUESTIONS.length) finish(); else loadQ(); }
function skip(){ state.index++; if(state.index>=QUESTIONS.length) finish(); else loadQ(); }
function finish(){
  state.xp+=10; save(); updateStatus();
  document.getElementById('feedback').innerHTML=`<span style="color:var(--good)">üéâ Well done! +10 XP</span>`;
  setTimeout(()=>{ document.getElementById('practice').classList.add('hidden'); document.getElementById('review').classList.remove('hidden'); renderReview(); },800);
}

function renderReview(){
  const area=document.getElementById('reviewArea'); area.innerHTML='';
  shuffle(QUESTIONS).slice(0,3).forEach(it=>{
    const div=document.createElement('div'); div.className='card'; div.style.marginBottom='8px';
    div.innerHTML=`<div style="display:flex;align-items:center;gap:12px"><div style="font-size:1.6rem">${it.emoji}</div><div><div style="font-weight:800">${it.q}</div><div class="small">${it.yes} / ${it.no}</div></div><div style="margin-left:auto"><button class="btn" onclick="mark(this)">‚úî</button></div></div>`;
    area.appendChild(div);
  });
}
function mark(btn){ btn.parentElement.parentElement.style.background='var(--good)'; btn.disabled=true; }
function shuffle(a){ return a.sort(()=>Math.random()-0.5); }

updateStatus();
</script>
</body>
</html>
