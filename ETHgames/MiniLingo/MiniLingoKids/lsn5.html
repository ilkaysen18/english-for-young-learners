<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Lesson 5 ‚Äî She has an umbrella ‚òÇÔ∏è</title>
<meta name="theme-color" content="#42A5F5"/>
<style>
/* ---------- Theme & Reset ---------- */
:root{
  --bg1:#E6F6FF; --bg2:#F0FBF7; --card:#ffffff; --accent:#42A5F5;
  --accent-2:#7DD3FC; --good:#4CAF50; --bad:#FF6B6B; --muted:#6B7280;
  --shadow: 0 8px 24px rgba(22,28,37,0.12);
  --radius:18px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; -webkit-font-smoothing:antialiased}
body{
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
  display:flex;align-items:flex-start;justify-content:center;padding:20px;
  color:#0f172a;
}

/* ---------- Card ---------- */
.container{
  width:100%;max-width:720px;background:var(--card);border-radius:20px;box-shadow:var(--shadow);
  overflow:hidden;margin:12px auto;
  transform-origin:center; 
}
.header{
  background:linear-gradient(90deg,var(--accent),var(--accent-2));
  color:white;padding:16px 18px;display:flex;align-items:center;gap:12px;justify-content:space-between;
}
.header .title{font-weight:800;font-size:1.05rem;display:flex;align-items:center;gap:10px}
.header .meta{font-size:.9rem;opacity:.95}
.stage-tabs{display:flex;gap:8px;background:rgba(255,255,255,0.06);padding:8px;border-radius:999px}
.tab{padding:6px 10px;border-radius:999px;cursor:pointer;font-weight:700;opacity:.95}
.tab.active{background:rgba(255,255,255,0.18)}

/* ---------- Main layout ---------- */
.content{display:grid;grid-template-columns:1fr 360px;gap:18px;padding:18px}
@media (max-width:880px){ .content{grid-template-columns:1fr; padding:12px} .side{order:2} }

/* ---------- Left: Learn / Practice ---------- */
.main-panel{min-height:300px}
.card-learn{background:linear-gradient(180deg,#fff,#fbfdff);padding:18px;border-radius:16px;border:1px solid rgba(6,8,10,0.04)}
.characters{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
.char{
  background:linear-gradient(180deg, #fff, #fbfbff); padding:12px;border-radius:14px;
  width:140px;display:flex;flex-direction:column;align-items:center;gap:8px;border:1px solid rgba(6,8,10,0.04);
  transition:transform .18s ease, box-shadow .18s ease;
}
.char:hover{transform:translateY(-6px);box-shadow:0 10px 24px rgba(6,8,10,0.08)}
.char .emoji{font-size:2.4rem}
.char .label{font-weight:700}

/* ---------- Sentence highlight ---------- */
.sentence{margin-top:12px;padding:12px;border-radius:12px;background:linear-gradient(90deg, rgba(66,165,245,0.06), rgba(125,211,252,0.04));font-weight:800;font-size:1.15rem;display:flex;align-items:center;gap:10px}

/* ---------- Right: Sidebar ---------- */
.side{padding:8px}
.info-card{background:linear-gradient(180deg,#fff,#fcffff);padding:12px;border-radius:12px;border:1px solid rgba(6,8,10,0.04);box-shadow:0 6px 18px rgba(6,8,10,0.04);margin-bottom:12px}
.small{font-size:.9rem;color:var(--muted)}

/* ---------- Practice area ---------- */
.practice-area{margin-top:12px}
.sentence-box{font-size:1.15rem;padding:12px;border-radius:12px;background:#f7feff;border:1px solid rgba(6,8,10,0.03);display:flex;align-items:center;gap:12px}
.choices{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:12px}
.choice-btn{
  background:white;border-radius:12px;padding:12px;border:1px solid rgba(6,8,10,0.06);
  font-size:1.25rem;cursor:pointer;display:flex;align-items:center;gap:12px;justify-content:center;box-shadow:0 8px 20px rgba(6,8,10,0.04);
  transition:transform .12s ease, box-shadow .12s ease; user-select:none;
}
.choice-btn:hover{transform:translateY(-6px);box-shadow:0 14px 30px rgba(6,8,10,0.07)}
.choice-emoji{font-size:2.2rem}
.feedback{height:36px;margin-top:10px;font-weight:800;display:flex;align-items:center;gap:8px}

/* ---------- Progress & footer ---------- */
.progress-wrap{margin-top:10px}
.progress{height:10px;background:#eef8ff;border-radius:999px;overflow:hidden}
.progress > div{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--good));transition:width .45s cubic-bezier(.2,.9,.3,1)}
.footer{display:flex;align-items:center;justify-content:space-between;margin-top:14px}
.btn-primary{background:var(--accent);color:white;padding:10px 14px;border-radius:12px;border:none;cursor:pointer;font-weight:800;box-shadow:0 8px 20px rgba(66,165,245,0.18)}
.btn-ghost{background:transparent;border:2px solid rgba(15,23,42,0.06);padding:8px 12px;border-radius:10px;cursor:pointer}

/* ---------- Tiny animations ---------- */
.correct-anim{animation:pop .45s ease}
@keyframes pop{0%{transform:scale(.98)}50%{transform:scale(1.06)}100%{transform:scale(1)}}

/* ---------- Responsive tweaks ---------- */
@media (max-width:520px){
  .characters .char{width:48%}
  .choices{grid-template-columns:1fr}
  .content{padding:12px}
}
</style>
</head>
<body>
<div class="container" role="main" aria-labelledby="lessonTitle">
  <div class="header">
    <div style="display:flex;align-items:center;gap:12px">
      <div class="title" id="lessonTitle">Lesson 5 ‚Äî <span style="font-weight:900">She has an umbrella</span> <span aria-hidden>‚òÇÔ∏è</span></div>
      <div class="stage-tabs" id="tabs" role="tablist" aria-label="Lesson stages">
        <div class="tab active" data-stage="learn" role="tab">Learn</div>
        <div class="tab" data-stage="practice" role="tab">Practice</div>
        <div class="tab" data-stage="review" role="tab">Review</div>
      </div>
    </div>
    <div class="meta">
      <span id="xpDisplay">XP: 0</span> ‚Ä¢ <span id="streakDisplay">Streak: 0</span>
    </div>
  </div>

  <div class="content">
    <!-- LEFT -->
    <div class="main-panel">
      <!-- LEARN -->
      <div id="learnStage" class="card-learn" aria-hidden="false">
        <h3 style="margin:0">Meet the characters</h3>
        <p class="small" style="margin:6px 0 0">Tap a character to hear the sentence. You can choose emoji style on the right.</p>
        <div class="characters" id="charactersArea" aria-live="polite">
          <!-- chars rendered by JS -->
        </div>

        <div class="sentence" id="explainSentence" aria-live="polite">
          <span id="explainEmoji" style="font-size:1.6rem">üëß</span>
          <span id="explainText">She has an umbrella.</span>
        </div>

        <div style="display:flex;justify-content:space-between;gap:8px;margin-top:12px">
          <button class="btn-ghost" onclick="playAudioExample()">üîä Hear example</button>
          <div style="display:flex;gap:8px">
            <button class="btn-ghost" onclick="document.querySelector('[data-stage=practice]').click()">Go to practice ‚ûú</button>
          </div>
        </div>
      </div>

      <!-- PRACTICE -->
      <div id="practiceStage" class="card-learn hidden" aria-hidden="true">
        <h3 style="margin:0">Practice ‚Äî Who has what?</h3>
        <p class="small" style="margin:6px 0 0">Read the sentence, then choose the correct character + object.</p>

        <div class="practice-area" id="practiceArea">
          <div class="sentence-box" id="practiceSentenceBox" aria-live="polite">
            <div style="font-weight:700">üîé</div>
            <div id="practiceSentenceText" style="flex:1">She has an umbrella.</div>
            <div style="min-width:70px;text-align:right" id="practiceScore">0 / 4</div>
          </div>

          <div class="progress-wrap">
            <div class="progress" aria-hidden><div id="progressBar"></div></div>
          </div>

          <div class="choices" id="choicesArea" role="list">
            <!-- buttons injected by JS -->
          </div>

          <div class="feedback" id="feedbackArea" aria-live="polite"></div>

          <div style="display:flex;justify-content:space-between;margin-top:12px">
            <button class="btn-ghost" onclick="skipQuestion()">Skip</button>
            <button class="btn-primary" id="nextBtn" onclick="nextQuestion()" disabled>Next ‚Üí</button>
          </div>
        </div>
      </div>

      <!-- REVIEW -->
      <div id="reviewStage" class="card-learn hidden" aria-hidden="true">
        <h3 style="margin:0">Review</h3>
        <p class="small" style="margin:6px 0 12px">Quick check ‚Äî match sentence to picture.</p>

        <div class="characters" id="reviewChars"></div>

        <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
          <div style="flex:1">
            <button class="btn-primary" onclick="runQuickCheck()">Start Review</button>
          </div>
          <div style="flex-basis:220px;text-align:right" id="reviewScoreArea"></div>
        </div>
      </div>
    </div>

    <!-- RIGHT SIDE -->
    <aside class="side" aria-label="Lesson tools">
      <div class="info-card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-weight:800">Emoji style</div>
            <div class="small">Choose which character set to show</div>
          </div>
        </div>
        <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn-ghost" onclick="setEmojiSet('standard')">Standard</button>
          <button class="btn-ghost" onclick="setEmojiSet('expressive')">Expressive</button>
          <button class="btn-ghost" onclick="setEmojiSet('kids')">Kids-only</button>
          <button class="btn-ghost" onclick="setEmojiSet('multi')">Multiple characters</button>
        </div>
      </div>

      <div class="info-card">
        <div style="font-weight:800">Lesson summary</div>
        <div class="small" style="margin-top:8px">
          Grammar: <strong>He/She has + object</strong><br/>
          Vocabulary: ‚òÇÔ∏è umbrella, üß¢ hat, üéí bag, üß• coat<br/>
          Key phrase: <em>She has an umbrella.</em>
        </div>
      </div>

      <div class="info-card">
        <div style="font-weight:800">Progress</div>
        <div class="small" style="margin-top:8px">Complete the set to earn XP and bump your streak.</div>
        <div style="margin-top:10px">
          <div class="small">Lesson progress</div>
          <div class="progress" style="margin-top:6px"><div id="sideBarProgress" style="width:0%;height:8px;background:linear-gradient(90deg,var(--accent),var(--accent-2));border-radius:999px"></div></div>
        </div>
      </div>

      <div class="info-card">
        <div style="font-weight:800">Quick tips</div>
        <ul class="small" style="margin:8px 0 0;padding-left:18px">
          <li>Use gestures: point to the person, then mime holding the object.</li>
          <li>Keep characters consistent ‚Äî kids love repeated faces.</li>
        </ul>
      </div>
    </aside>
  </div>
</div>

<script>
/* ---------- Data ---------- */
const LESSON_ID = 5;
const ITEMS = [
  {id:1, personKey:'girl1', personLabel:'She', itemKey:'umbrella', itemLabel:'an umbrella', emoji:{standard:'üëß ‚òÇÔ∏è', expressive:'üëßüèª ‚òÇÔ∏è', kids:'üëß ‚òÇÔ∏è', multi:'Anna ‚òÇÔ∏è'}},
  {id:2, personKey:'boy1', personLabel:'He', itemKey:'hat', itemLabel:'a hat', emoji:{standard:'üë¶ üß¢', expressive:'üßí üß¢', kids:'üë¶ üß¢', multi:'Tom üß¢'}},
  {id:3, personKey:'girl2', personLabel:'She', itemKey:'bag', itemLabel:'a bag', emoji:{standard:'üëß üéí', expressive:'üëßüèΩ üéí', kids:'üëß üéí', multi:'Maya üéí'}},
  {id:4, personKey:'boy2', personLabel:'He', itemKey:'coat', itemLabel:'a coat', emoji:{standard:'üë¶ üß•', expressive:'üë® üß•', kids:'üë¶ üß•', multi:'Liam üß•'}}
];

/* ---------- State ---------- */
let state = {
  stage:'learn',
  emojiSet:'standard',
  index:0,
  corrects:0,
  attempts:0,
  currentOrder:[], // randomized choices
  xp: JSON.parse(localStorage.getItem('minilingoState')||'{}').xp || 0,
  streak: JSON.parse(localStorage.getItem('minilingoState')||'{}').streak || 0
};

/* ---------- Helpers: localStorage ---------- */
function saveStateToStorage(){
  const s = JSON.parse(localStorage.getItem('minilingoState')||'{}');
  s.xp = state.xp;
  s.streak = state.streak;
  s.progress = s.progress || {};
  s.progress[LESSON_ID] = (state.corrects >= ITEMS.length);
  localStorage.setItem('minilingoState', JSON.stringify(s));
}

/* ---------- UI rendering ---------- */
const charactersArea = document.getElementById('charactersArea');
const explainEmoji = document.getElementById('explainEmoji');
const explainText = document.getElementById('explainText');
const xpDisplay = document.getElementById('xpDisplay');
const streakDisplay = document.getElementById('streakDisplay');
const sideBarProgress = document.getElementById('sideBarProgress');
const reviewChars = document.getElementById('reviewChars');

function renderCharacters(){
  charactersArea.innerHTML = '';
  ITEMS.forEach(it=>{
    const div = document.createElement('button');
    div.className = 'char';
    div.type = 'button';
    div.setAttribute('aria-label', `${it.personLabel} has ${it.itemLabel}`);
    const em = document.createElement('div'); em.className='emoji'; em.textContent = it.emoji[state.emojiSet];
    const label = document.createElement('div'); label.className='label'; label.textContent = `${it.personLabel} has ${it.itemLabel}`;
    div.appendChild(em); div.appendChild(label);
    div.onclick = ()=> {
      explainEmoji.textContent = it.emoji[state.emojiSet].split(' ')[0] || it.emoji[state.emojiSet];
      explainText.textContent = `${it.personLabel} has ${it.itemLabel}.`;
      playTTS(`${it.personLabel} has ${it.itemLabel}`);
      // small pop
      div.classList.add('correct-anim');
      setTimeout(()=>div.classList.remove('correct-anim'),450);
    };
    charactersArea.appendChild(div);
  });
  // also fill review area
  reviewChars.innerHTML = '';
  ITEMS.forEach(it=>{
    const rc = document.createElement('div'); rc.className='char';
    const em = document.createElement('div'); em.className='emoji'; em.textContent = it.emoji[state.emojiSet];
    const label = document.createElement('div'); label.className='label'; label.textContent = `${it.personLabel} has ${it.itemLabel}`;
    rc.appendChild(em); rc.appendChild(label);
    reviewChars.appendChild(rc);
  });
}

/* ---------- Emoji set switching ---------- */
function setEmojiSet(k){
  state.emojiSet = k;
  renderCharacters();
}
setEmojiSet('standard');

/* ---------- Stage tabs ---------- */
document.querySelectorAll('.tab').forEach(t=>{
  t.addEventListener('click', ()=>{
    document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    const stage = t.dataset.stage;
    setStage(stage);
  });
});

function setStage(stage){
  state.stage = stage;
  document.getElementById('learnStage').classList.toggle('hidden', stage!=='learn');
  document.getElementById('practiceStage').classList.toggle('hidden', stage!=='practice');
  document.getElementById('reviewStage').classList.toggle('hidden', stage!=='review');
  document.getElementById('learnStage').setAttribute('aria-hidden', stage!=='learn');
  document.getElementById('practiceStage').setAttribute('aria-hidden', stage!=='practice');
  document.getElementById('reviewStage').setAttribute('aria-hidden', stage!=='review');
  if(stage==='practice') initPractice();
}

/* ---------- TTS (simple) ---------- */
function playTTS(text){
  if(window.speechSynthesis){
    try{
      window.speechSynthesis.cancel();
      const ut = new SpeechSynthesisUtterance(text);
      ut.rate = 0.95; ut.lang = 'en-US';
      window.speechSynthesis.speak(ut);
    }catch(e){}
  }
}
function playAudioExample(){ playTTS('She has an umbrella. He has a hat. She has a bag. He has a coat.'); }

/* ---------- Practice logic ---------- */
const practiceSentenceText = document.getElementById('practiceSentenceText');
const choicesArea = document.getElementById('choicesArea');
const progressBar = document.getElementById('progressBar');
const feedbackArea = document.getElementById('feedbackArea');
const practiceScore = document.getElementById('practiceScore');
const nextBtn = document.getElementById('nextBtn');

function initPractice(){
  state.index = 0;
  state.corrects = 0;
  state.attempts = 0;
  state.currentOrder = shuffle([...ITEMS]);
  updatePracticeUI();
  loadQuestion();
}

function updatePracticeUI(){
  xpDisplay.textContent = `XP: ${state.xp}`;
  streakDisplay.textContent = `Streak: ${state.streak}`;
  sideBarProgress.style.width = `${(state.corrects/ITEMS.length)*100}%`;
}

function loadQuestion(){
  nextBtn.disabled = true;
  feedbackArea.textContent = '';
  progressBar.style.width = `${(state.index/ITEMS.length)*100}%`;
  practiceScore.textContent = `${state.corrects} / ${ITEMS.length}`;
  const correctItem = state.currentOrder[state.index];
  practiceSentenceText.textContent = `${correctItem.personLabel} has ${correctItem.itemLabel}.`;
  playTTS(practiceSentenceText.textContent);

  // prepare mixed options: correct + 3 others (or fewer)
  const opts = shuffle([...ITEMS]).slice(0,4);
  if(!opts.some(o=>o.id===correctItem.id)) opts[0] = correctItem;
  // randomize display
  const display = shuffle(opts);

  choicesArea.innerHTML = '';
  display.forEach(opt=>{
    const btn = document.createElement('button');
    btn.className = 'choice-btn';
    btn.setAttribute('role','button');
    btn.innerHTML = `<div class="choice-emoji">${opt.emoji[state.emojiSet]}</div><div style="font-weight:700">${opt.personLabel}</div>`;
    btn.onclick = ()=> handleChoice(opt, correctItem, btn);
    choicesArea.appendChild(btn);
  });
}

function handleChoice(selected, correctItem, btn){
  state.attempts++;
  const isCorrect = selected.id === correctItem.id;
  if(isCorrect){
    state.corrects++;
    feedbackArea.innerHTML = `<span style="color:var(--good)">‚úÖ Correct ‚Äî ${correctItem.personLabel} has ${correctItem.itemLabel}.</span>`;
    btn.classList.add('correct-anim');
    // XP & UI bump
    state.xp += 5;
    state.streak = (state.streak || 0) + 1;
    saveStateToStorage();
    updatePracticeUI();
    // mark next enabled after a short delay
    nextBtn.disabled = false;
    // visually indicate correct on progress
    progressBar.style.width = `${((state.index+1)/ITEMS.length)*100}%`;
  } else {
    feedbackArea.innerHTML = `<span style="color:var(--bad)">‚ùå Not quite ‚Äî try again!</span>`;
    state.xp += 1;
    state.streak = 0;
    saveStateToStorage();
    updatePracticeUI();
    // small shake on button
    btn.animate([{transform:'translateX(-4px)'},{transform:'translateX(4px)'},{transform:'translateX(0)'}],{duration:260});
  }
}

function nextQuestion(){
  state.index++;
  if(state.index >= ITEMS.length){
    finishPractice();
  } else {
    loadQuestion();
  }
}

function skipQuestion(){
  state.index++;
  if(state.index >= ITEMS.length) finishPractice();
  else loadQuestion();
}

function finishPractice(){
  // reward
  state.xp += 10;
  saveStateToStorage();
  updatePracticeUI();
  // show final feedback, then auto-switch to review
  feedbackArea.innerHTML = `<div style="color:var(--good)">üéâ Well done! You finished the practice. +10 XP</div>`;
  setTimeout(()=> {
    document.querySelector('[data-stage=review]').click();
    document.getElementById('reviewScoreArea').textContent = `Score: ${state.corrects} / ${ITEMS.length}`;
  },900);
}

/* ---------- QUICK Review ---------- */
function runQuickCheck(){
  // simple matching shuffle quick check
  const qOrder = shuffle([...ITEMS]);
  let qIndex = 0, qScore = 0;
  function showOne(){
    if(qIndex >= qOrder.length){
      document.getElementById('reviewScoreArea').textContent = `Result: ${qScore} / ${qOrder.length}`;
      return;
    }
    const q = qOrder[qIndex];
    const user = confirm(`${q.personLabel} has ${q.itemLabel}.\n\nDoes this match the picture shown? (OK = Yes, Cancel = No)\n\nNote: This quick check uses a confirm dialog for speedy review.`);
    // in a real UI we'd render clickable cards; using confirm keeps file self-contained.
    if(user) qScore++;
    qIndex++; showOne();
  }
  showOne();
}

/* ---------- Utilities ---------- */
function shuffle(a){ return a.sort(()=>Math.random()-0.5) }

/* ---------- Init ---------- */
renderCharacters();
updatePracticeUI();

/* ---------- Accessibility: keyboard nav ---------- */
document.addEventListener('keydown', (e)=>{
  if(e.key === '1') setEmojiSet('standard');
  if(e.key === '2') setEmojiSet('expressive');
  if(e.key === '3') setEmojiSet('kids');
  if(e.key === '4') setEmojiSet('multi');
});
</script>
</body>
</html>
